!function(o){o.fn.wizard=function(t){return new Wizard(this,t)},o.fn.wizard.logging=!1;var a=function(t,i,s,e,n){this.wizard=t,this.index=s,this.prev=e,this.next=n,this.el=i,this.title=i.find("h3").first().text(),this.name=i.data("cardname")||this.title,this.nav=this._createNavElement(this.title,s),this._disabled=!1,this._loaded=!1,this._events={}};a.prototype={select:function(){this.log("selecting"),this.isSelected()||(this.nav.addClass("active"),this.el.show(),this._loaded||(this.trigger("loaded"),this.reload()),this.trigger("selected"));var t=this.wizard;return t.backButton.toggleClass("disabled",0==this.index),this.index>=t._cards.length-1?(this.log("on last card, changing next button to submit"),t.changeNextButton(t.args.buttons.submitText,"btn-success"),t._readyToSubmit=!0,t.trigger("readySubmit")):(t._readyToSubmit=!1,t.changeNextButton(t.args.buttons.nextText,"btn-primary")),this},_createNavElement:function(t,i){var s=o('<li class="wizard-nav-item"></li>'),e=o('<a class="wizard-nav-link"></a>');return e.data("navindex",i),s.append(e),e.append('<i class="fas fa-chevron-right"></i> '),e.append(t),s},markVisited:function(){return this.log("marking as visited"),this.nav.addClass("already-visited"),this.trigger("markVisited"),this},unmarkVisited:function(){return this.log("unmarking as visited"),this.nav.removeClass("already-visited"),this.trigger("unmarkVisited"),this},deselect:function(){return this.nav.removeClass("active"),this.el.hide(),this.trigger("deselect"),this},enable:function(){return this.log("enabling"),this.nav.addClass("active"),this._disabled=!1,this.trigger("enabled"),this},disable:function(t){return this.log("disabling"),this._disabled=!0,this.nav.removeClass("active already-visited"),t&&this.el.hide(),this.trigger("disabled"),this},isDisabled:function(){return this._disabled},alreadyVisited:function(){return this.nav.hasClass("already-visited")},isSelected:function(){return this.nav.hasClass("active")},reload:function(){return this._loaded=!0,this.trigger("reload"),this},on:function(){return this.wizard.on.apply(this,arguments)},trigger:function(){return this.callListener("on"+arguments[0]),this.wizard.trigger.apply(this,arguments)},toggleAlert:function(t,i){var s;this.log("toggling alert to: "+i),(i=void 0===i||i)?this.trigger("showAlert"):this.trigger("hideAlert");var e=this.el.children("h3").first().next("div.alert");if(0==e.length){if(!i)return this;this.log("couldn't find existing alert div, creating one"),(s=o("<div />")).addClass("alert"),s.addClass("hide"),s.insertAfter(this.el.find("h3").first())}else this.log("found existing alert div"),s=e.first();return i?(null!=t&&(this.log("setting alert msg to",t),s.html(t)),s.show()):s.hide(),this},callListener:function(i){i=i.toLowerCase(),this.log("looking for listener "+i);var t=window[this.el.data(i)];if(t){this.log("calling listener "+i);this.wizard;try{t(this)}catch(t){this.log("exception calling listener "+i+": ",t)}}else this.log("didn't find listener "+i)},problem:function(t){this.nav.find("a").toggleClass("wizard-step-error",t)},validate:function(){var r=!1,a=this;this.el.find("[data-validate]").each(function(t,i){a.log("validating individiual inputs");var s=(i=o(i)).data("validate");if(s){var e={status:!0,title:"Error",msg:""},n=window[s](i);if(o.extend(e,n),1===o("#btn-"+i.attr("id")).length&&(i=o("#btn-"+i.attr("id"))),e.status){i.parents("div.form-group").toggleClass("has-error",!1),1===o("#btn-"+i.attr("id")).length&&(i=o("#btn-"+i.attr("id")));try{i.popover("destroy")}catch(t){i.popover("hide")}}else r=!0,i.parents("div.form-group").toggleClass("has-error",!0),1===o("#btn-"+i.attr("id")).length&&(i=o("#btn-"+i.attr("id"))),a.wizard.errorPopover(i,e.msg)}}),this.log("after validating inputs, failures is",r);var t=window[this.el.data("validate")];if(t){this.log("running html-embedded card validator");var i=t(this);void 0!==i&&null!=i||(i=!0),i||(r=!0),this.log("after running html-embedded card validator, failures is",r)}this.log("running listener validator");var s=this.trigger("validate");void 0!==s&&null!=s||(s=!0),s||(r=!0),this.log("after running listener validator, failures is",r);var e=!r;return e?(this.log("validated, calling listeners"),this.trigger("validated")):(this.log("invalid"),this.trigger("invalid")),e},log:function(){if(window.console&&o.fn.wizard.logging){var t=["card '"+this.name+"': "];t.push.apply(t,arguments),console.log.apply(console,t)}},isActive:function(){return this.nav.hasClass("active")}},Wizard=function(t,i){this.wizard_template=['<div  class="modal fade wizard" tabindex="-1" role="dialog">','<div class="modal-dialog modal-lg wizard-dialog" role="document">','<div class="modal-content wizard-content">','<div class="modal-header wizard-header flex-row align-items-center">','<h5 class="modal-title wizard-title font-weight-bold"></h5>','<span class="wizard-subtitle"></span>','<button type="button" class="close wizard-close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>',"</div>",'<form class="modal-body wizard-body">','<div class="float-left wizard-steps">','<div class="wizard-nav-container">','<ul class="nav wizard-nav-list">',"</ul>","</div>",'<div class="wizard-progress-container">','<div class="progress progress-striped">','<div class="progress-bar progress-bar-striped progress-bar-animated" style="width: 0%;"></div>',"</div>","</div>","</div>",'<div class="wizard-cards">','<div class="wizard-card-container">',"</div>",'<div class="wizard-footer">','<div class="wizard-buttons-container">','<button class="btn btn-secondary wizard-cancel wizard-close" type="button">Cancel</button>','<div class="btn-group-single float-right">','<button class="btn btn-secondary wizard-back" type="button">Back</button>','<button class="btn btn-primary wizard-next" type="button">Next</button>',"</div>","</div>","</div>","</div>","</form>","</div>","</div>","</div>"],this.args={keyboard:!0,backdrop:!0,show:!1,submitUrl:"",showCancel:!1,showClose:!0,progressBarCurrent:!1,increaseHeight:0,contentHeight:300,contentWidth:580,buttons:{cancelText:"Cancel",nextText:"Next",backText:"Back",submitText:"Submit",submittingText:"Submitting..."},formClass:"form-horizontal"},o.extend(this.args,i||{}),this._create(t)},Wizard.prototype={log:function(){if(window.console&&o.fn.wizard.logging){var t=["wizard "+this.el.id+": "];t.push.apply(t,arguments),console.log.apply(console,t)}},_create:function(t){this.markup=o(t),this.title=this.markup.data("title"),this.submitCards=this.markup.find(".wizard-error,.wizard-failure,.wizard-success,.wizard-loading"),this.el=o(this.wizard_template.join("\n")),o("body").append(this.el),this.modal=this.el.modal({keyboard:this.args.keyboard,show:this.args.show,backdrop:this.args.backdrop}),this.dimensions={contentHeight:this.args.contentHeight,contentWidth:this.args.contentWidth},this.dialog=this.modal.find(".wizard-dialog"),this.content=this.modal.find(".wizard-content"),this.header=this.modal.find(".wizard-header"),this.body=this.modal.find(".wizard-body"),this.wizardSteps=this.modal.find(".wizard-steps"),this.wizardCards=this.modal.find(".wizard-cards"),this.wizardCardContainer=this.modal.find(".wizard-card-container"),this.wizardCardContainer.append(this.markup.find(".wizard-card")).append(this.submitCards),this.navContainer=this.modal.find(".wizard-nav-container"),this.navList=this.modal.find(".wizard-nav-list"),this.progressContainer=this.modal.find(".wizard-progress-container"),this.progress=this.progressContainer.find(".progress-bar"),this.closeButton=this.modal.find("button.wizard-close.close"),this.cardsContainer=this.modal.find("wizard-cards-container"),this.form=this.modal.find("form"),this.footer=this.modal.find(".wizard-footer"),this.cancelButton=this.footer.find(".wizard-cancel"),this.backButton=this.footer.find(".wizard-back"),this.nextButton=this.footer.find(".wizard-next"),this._cards=[],this.cards={},this._readyToSubmit=!1,this.percentComplete=0,this._submitting=!1,this._events={},this._firstShow=!0,this._createCards(),this.nextButton.click(this,this._handleNextClick),this.backButton.click(this,this._handleBackClick),this.cancelButton.text(this.args.buttons.cancelText),this.backButton.text(this.args.buttons.backText),this.nextButton.text(this.args.buttons.nextText),this.form.addClass(this.args.formClass),this.popovers=[];var i=this,s=function(){i.reset(),i.close(),i.trigger("closed")};this.closeButton.click(s),this.cancelButton.click(s),this.wizardSteps.on("click","li.already-visited a.wizard-nav-link",this,function(t){var i=parseInt(o(t.target).data("navindex"));t.data.setCard(i)}),0!=this.title.length&&this.setTitle(this.title),this.on("submit",this._defaultSubmit),this.autoDimensions()},autoDimensions:function(){this.modal.css("display","block"),this.dimensions.header=this.header.outerHeight(!0),this.dimensions.navigation=this.wizardSteps.outerHeight(!0),this.dimensions.navigation<this.dimensions.contentHeight&&(this.dimensions.navigation=this.dimensions.contentHeight,this.navContainer.height(this.dimensions.contentHeight-30-this.progressContainer.outerHeight(!0))),this.dimensions.body=this.dimensions.navigation,this.wizardSteps.height(this.dimensions.body),this.dimensions.modal=this.dimensions.header+this.dimensions.navigation,this.content.height(this.dimensions.modal+"px"),this.dialog.width(this.dimensions.contentWidth),this.body.height(this.dimensions.body+"px"),this.wizardCards.height(this.dimensions.body+"px"),this.dimensions.footer=this.footer.outerHeight(!0),this.dimensions.cardContainer=this.dimensions.body-this.dimensions.footer,this.wizardCardContainer.height(this.dimensions.cardContainer),this.dimensions.offset=(o(window).height()-this.dialog.height())/2,this.dialog.css({"margin-top":this.dimensions.offset+"px","padding-top":0}),this.modal.css("display","")},setTitle:function(t){return this.log("setting title to",t),this.modal.find(".wizard-title").first().text(t),this},setSubtitle:function(t){return this.log("setting subtitle to",t),this.modal.find(".wizard-subtitle").first().text(t),this},errorPopover:function(t,i,s){this.log("launching popover on",t),s=void 0!==s&&s;var e=t.popover({content:i,trigger:"manual",html:s,container:t.parents(".form-group")}).addClass("error-popover").popover("show").next(".popover");return t.parents(".form-group").find(".popover").addClass("error-popover"),this.popovers.push(t),e},destroyPopover:function(t){(t=o(t)).popover("dispose")},hidePopovers:function(t){this.log("hiding all popovers");var s=this;o.each(this.popovers,function(t,i){s.destroyPopover(i)}),this.modal.find(".has-error").removeClass("has-error"),this.popovers=[]},eachCard:function(t){return o.each(this._cards,t),this},getActiveCard:function(){this.log("getting active card");var s=null;return o.each(this._cards,function(t,i){if(i.isActive())return s=i,!1}),s?this.log("found active card",s):this.log("couldn't find an active card"),s},changeNextButton:function(t,i){return this.log("changing next button, text: "+t,"class: "+i),void 0!==i&&this.nextButton.removeClass("btn-success btn-primary"),i&&this.nextButton.addClass(i),this.nextButton.text(t),this},hide:function(){return this.log("hiding"),this.modal.modal("hide"),this},close:function(){return this.log("closing"),this.modal.modal("hide"),this},show:function(t){return this.log("showing"),this._firstShow&&(this.setCard(0),this._firstShow=!1),this.args.showCancel?this.cancelButton.show():this.cancelButton.hide(),this.args.showClose&&this.closeButton.show(),this.modal.modal("show"),this},on:function(t,i){return this.log("adding listener to event "+t),this._events[t]=i,this},trigger:function(){var i=arguments[0],t=Array.prototype.slice.call(arguments);t.shift(),t.unshift(this),this.log("firing event "+i);var s=this._events[i];void 0===s&&void 0!==this.wizard&&(s=this.wizard._events[i]);var e=null;if("function"==typeof s){this.log("found event handler, calling "+i);try{e=s.apply(this,t)}catch(t){this.log("event handler "+i+" had an exception")}}else this.log("couldn't find an event handler for "+i);return e},reset:function(){return this.log("resetting"),this.updateProgressBar(0),this.hideSubmitCards(),this.setCard(0),this.lockCards(),this.enableNextButton(),this.showButtons(),this.hidePopovers(),this.trigger("reset"),this},_abstractIncrementStep:function(t,i){var s,e=this.getActiveCard();if(e)for(this.log("searching for valid next card");;){if(s=i(e)){if(this.log("looking at card",s.index),s.isDisabled()){this.log("card "+s.index+" is disabled/locked, continuing"),e=s;continue}return this.setCard(e.index+t)}this.log("next card is not defined, breaking");break}else this.log("current card is undefined")},incrementCard:function(){this.log("incrementing card");var t=this._abstractIncrementStep(1,function(t){return t.next});return this.trigger("incrementCard"),t},decrementCard:function(){this.log("decrementing card");var t=this._abstractIncrementStep(-1,function(t){return t.prev});return this.trigger("decrementCard"),t},setCard:function(t){this.log("setting card to "+t),this.hideSubmitCards();var i=this.getActiveCard();if(this._submitting)return this.log("we're submitting the wizard already, can't change cards"),i;var s=this._cards[t];if(s){if(s.isDisabled())return this.log("new card is currently disabled, returning"),i;if(i){if(t>i.index){for(var e=i;e.index!=s.index;){if(e.index!=i.index&&(e.prev.deselect(),e.prev.markVisited(),e.select()),!e.validate())return e;e=e.next}e.prev.deselect(),e.prev.markVisited()}i.deselect(),i.markVisited()}if(s.select(),this.args.progressBarCurrent)this.percentComplete=100*t/this._cards.length,this.updateProgressBar(this.percentComplete);else{var n=this.percentComplete;this.percentComplete=100*t/this._cards.length,this.percentComplete=Math.max(n,this.percentComplete),this.updateProgressBar(this.percentComplete)}return s}this.log("couldn't find card "+t)},updateProgressBar:function(t){this.log("updating progress to "+t+"%"),this.progress.css({width:t+"%"}),this.percentComplete=t,this.trigger("progressBar",t),100==t?(this.log("progress is 100, animating progress bar"),this.progressContainer.find(".progress").addClass("active")):0==t&&(this.log("progress is 0, disabling animation"),this.progressContainer.find(".progress").removeClass("active"))},getNextCard:function(){var t=this.getActiveCard();if(t)return t.next},lockCards:function(){return this.log("locking nav cards"),this.eachCard(function(t,i){i.unmarkVisited()}),this},disableCards:function(){return this.log("disabling all nav cards"),this.eachCard(function(t,i){i.disable()}),this},enableCards:function(){return this.log("enabling all nav cards"),this.eachCard(function(t,i){i.enable()}),this},hideCards:function(){return this.log("hiding cards"),this.eachCard(function(t,i){i.deselect()}),this.hideSubmitCards(),this},hideButtons:function(){return this.log("hiding buttons"),this.cancelButton.hide(),this.closeButton.hide(),this.nextButton.hide(),this.backButton.hide(),this},showButtons:function(){return this.log("showing buttons"),this.args.showCancel?this.cancelButton.show():this.cancelButton.hide(),this.args.showClose&&this.closeButton.show(),this.nextButton.show(),this.backButton.show(),this},getCard:function(t){var s=o(t).parents(".wizard-card").first()[0];if(s){var e=null;return this.eachCard(function(t,i){return s!=i.el[0]||(e=i,!1)}),e}return null},_createCards:function(){var s=null,e=null,n=this,r=this;r.log("Creating Cards");var t=this.modal.find(".wizard-cards .wizard-card");o.each(t,function(t,i){i=o(i),e=new a(n,i,t,s=e,null),r._cards.push(e),e.name&&(r.cards[e.name]=e),s&&(s.next=e),r.modal.find(".wizard-steps .wizard-nav-list").append(e.nav)})},showSubmitCard:function(t){this.log("showing "+t+" submit card"),this.el.find(".wizard-"+t).length?(this.hideCards(),this.el.find(".wizard-"+t).show()):this.log("couldn't find submit card "+t)},hideSubmitCard:function(t){this.log("hiding "+t+" submit card"),this.el.find(".wizard-"+t).hide()},hideSubmitCards:function(){var s=this;o.each(["success","error","failure","loading"],function(t,i){s.hideSubmitCard(i)})},enableNextButton:function(){return this.log("enabling next button"),this.nextButton.removeAttr("disabled"),this},disableNextButton:function(){return this.log("disabling next button"),this.nextButton.attr("disabled","disabled"),this},serializeArray:function(){var t=this.form.serializeArray();return this.form.find('input[disabled][data-serialize="1"]').each(function(){formObj={name:o(this).attr("name"),value:o(this).val()},t.push(formObj)}),t},serialize:function(){var t=this.form.serialize();return this.form.find('input[disabled][data-serialize="1"]').each(function(){t=t+"&"+o(this).attr("name")+"="+o(this).val()}),t},find:function(t){return this.modal.find(t)},submitSuccess:function(){this.log("submit success"),this._submitting=!1,this.showSubmitCard("success"),this.trigger("submitSuccess")},submitFailure:function(){this.log("submit failure"),this._submitting=!1,this.showSubmitCard("failure"),this.trigger("submitFailure")},submitError:function(){this.log("submit error"),this._submitting=!1,this.showSubmitCard("error"),this.trigger("submitError")},_submit:function(){this.log("submitting wizard"),this._submitting=!0,this.lockCards(),this.cancelButton.hide(),this.closeButton.hide(),this.backButton.hide(),this.showSubmitCard("loading"),this.updateProgressBar(100),this.changeNextButton(this.args.buttons.submittingText,!1),this.disableNextButton();this.trigger("submit");this.trigger("loading")},_onNextClick:function(){this.log("handling 'next' button click");var t=this.getActiveCard();this._readyToSubmit&&t.validate()?this._submit():t=this.incrementCard()},_onBackClick:function(){this.log("handling 'back' button click");this.decrementCard()},_handleNextClick:function(t){var i=t.data;i._onNextClick.call(i)},_handleBackClick:function(t){var i=t.data;i._onBackClick.call(i)},_defaultSubmit:function(i){o.ajax({type:"POST",url:i.args.submitUrl,data:i.serialize(),dataType:"json"}).done(function(t){i.submitSuccess(),i.hideButtons(),i.updateProgressBar(0)}).fail(function(){i.submitFailure(),i.hideButtons()})}}}(window.jQuery);