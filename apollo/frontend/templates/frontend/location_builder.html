{% extends 'frontend/_layout.html' %}
{% block stylesheets %}
<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/joint.min.css') }}">
{% endblock stylesheets %}
{% block subtitle %}<a href="{{ url_for('locationset.index_view') }}">{{ location_set.name }}</a>{% endblock subtitle %}
{% block toolbar %}
<div class="btn-group pull-right">
  <form id="save-form" method="POST">
    <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
    <input type="hidden" name="divisions_graph" id="divisions_graph" value="" />
    <button style="margin-left:1em" type="submit" class="btn btn-sm btn-primary" id="save"><i class="glyphicon glyphicon-floppy-save"></i> {{ _('Save') }}</button>
  </form>
</div>
<div class="btn-group pull-right">
  <button style="margin-right:1em" type="button" class="btn btn-sm btn-default" id="addDivisionButton"><i class="glyphicon glyphicon-plus"></i> {{ _('Add division') }}</button>
  <a href="{{ url_for('locations.export_divisions', location_set_id=location_set.id) }}" class="btn btn-sm btn-default"><i class="glyphicon glyphicon-download"></i> {{ _('Export') }}</a>
  {% if not has_admin_divisions %}
  <button class="btn btn-sm btn-default" data-toggle="modal" data-target="#importModal"><i class="glyphicon glyphicon-upload"></i> {{ _('Import') }}</button>
  {% endif %}
</div>
{% endblock toolbar %}
{% block content %}
<div class="modal fade" id="addDivision" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{ _('Add Division') }}</h4>
      </div>
      <form role="form" class="form-horizontal">
      <div class="modal-body" style="padding-bottom:5px">
        <div class="form-group">
          <label for="name" class="col-sm-2 control-label">{{ _('Name') }}</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="addDivisionName">
          </div>
        </div>
        <div class="form-group">
          <label for="parents" class="col-sm-2 control-label">{{ _('Parents') }}</label>
          <div class="col-sm-10">
            <select multiple="multiple" class="form-control" name="parents" id="addDivisionParents">
            </select>
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-10 col-sm-offset-2">
            <div class="checkbox">
              <label for="addDivisionAdministrative">
                <input type="checkbox" name="is_administrative" id="addDivisionAdministrative" value="true" /> {{ _('Display on dashboard and in tables') }}
              </label>
            </div>
            <div class="checkbox">
              <label for="addDivisionPolitical">
                <input type="checkbox" name="is_political" id="addDivisionPolitical" value="true" /> {{ _('Use in data summary') }}
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="row">
            <div class="col-sm-8 col-sm-offset-2">
              <div class="panel-group" id="accordion-add" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="add-heading">
                    <h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="accordion-add" aria-expanded="true" aria-controls="add-extra-options" href="#add-extra-options">{{ _('More Options') }}</a></h4>
                  </div>
                  <div id="add-extra-options" class="panel-collapse collapse" role="tabpanel" aria-labelledby="add-heading">
                    <div class="panel-body">
                      <div class="checkbox">
                        <label for="addDivisionRegisteredVoters">
                          <input type="checkbox" name="has_registered_voters" id="addDivisionRegisteredVoters" value="true" /> {{ _('Has Registered Voters') }}
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
        <button type="button" class="btn btn-primary" id="addModalSaveButton">{{ _('Add') }}</button>
      </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
<div class="modal fade" id="updateDivision" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        <h4 class="modal-title">{{ _('Update Division') }}</h4>
      </div>
      <form role="form" class="form-horizontal">
      <div class="modal-body" style="padding-bottom:5px">
        <div class="form-group">
          <label for="name" class="col-sm-2 control-label">{{ _('Name') }}</label>
          <div class="col-sm-10">
            <input type="text" class="form-control" id="updateDivisionName" name="name">
          </div>
        </div>
        <div class="form-group">
          <label for="parents" class="col-sm-2 control-label">{{ _('Parents') }}</label>
          <div class="col-sm-10">
            <select multiple="multiple" class="form-control" name="parents" id="updateDivisionParents">
            </select>
            <input type="hidden" class="form-control" id="updateDivisionId" name="id">
          </div>
        </div>
        <div class="form-group">
          <div class="col-sm-10 col-sm-offset-2">
            <div class="checkbox">
              <label for="updateDivisionAdministrative">
                <input type="checkbox" name="is_administrative" id="updateDivisionAdministrative" value="true" /> {{ _('Display on dashboard and in tables') }}
              </label>
            </div>
            <div class="checkbox">
              <label for="updateDivisionPolitical">
                <input type="checkbox" name="is_political" id="updateDivisionPolitical" value="true" /> {{ _('Use in data summary') }}
              </label>
            </div>
          </div>
        </div>
        <div class="form-group">
          <div class="row">
            <div class="col-sm-8 col-sm-offset-2">
              <div class="panel-group" id="accordion-update" role="tablist" aria-multiselectable="true">
                <div class="panel panel-default">
                  <div class="panel-heading" role="tab" id="update-heading">
                    <h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="accordion-update" aria-expanded="true" aria-controls="update-extra-options" href="#update-extra-options">{{ _('More Options') }}</a></h4>
                  </div>
                  <div id="update-extra-options" class="panel-collapse collapse" role="tabpanel" aria-labelledby="update-heading">
                    <div class="panel-body">
                      <div class="checkbox">
                        <label for="updateDivisionRegisteredVoters">
                          <input type="checkbox" name="has_registered_voters" id="updateDivisionRegisteredVoters" value="true" /> {{ _('Has Registered Voters') }}
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
        <button type="button" class="btn btn-danger" id="updateModalDeleteButton">{{ _('Delete') }}</button>
        <button type="button" class="btn btn-primary" id="updateModalSaveButton">{{ _('Update') }}</button>
      </div>
      </form>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
{% if not has_admin_divisions %}
<div class="modal fade" id="importModal" role="dialog" aria-labelledby="importModalLabel">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="importModalLabel">{{ _('Import Admin Divisions') }}</h4>
      </div>
      <div class="modal-body">
        <form action="{{ url_for('locations.import_divisions', location_set_id=location_set.id) }}" enctype="multipart/form-data" method="post">
          {{ form.hidden_tag() }}
          <div class="form-group">
            {{ form.import_file }}
          </div>
          <div class="form-group">
            <button type="submit" class="btn btn-primary">{{ _('Import') }}</button>
            <button type="button" class="btn btn-default" data-dismiss="modal">{{ _('Close') }}</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>
{% endif %}
{%- set flash_msgs = get_flashed_messages(category_filter=['locations_builder']) -%}
{%- if flash_msgs -%}
<div class="row">
  <div class="col-md-12">
{%- for msg in flash_msgs -%}
    <div class="alert alert-info alert-dismissable">
      <button type="button" class="close" data-dismiss="alert" aria-hidden="true">&times;</button>
      {{ msg }}
    </div>
{%- endfor -%}
  </div>
</div>
{%- endif -%}
<div class="row">
  <div class="col-md-12">
    <div id="paper" style="margin-top: 5em" data-graph='{{ location_set.make_admin_divisions_graph()|tojson }}'></div>
  </div>
</div>
{% endblock content %}
{% block scripts %}
<script type="text/javascript" src="{{ url_for('static', filename='js/lodash.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/backbone-min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/dagre.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/graphlib.core.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/joint.min.js') }}"></script>
<script type="text/javascript" src="{{ url_for('static', filename='js/locations_builder.js') }}"></script>
{% endblock scripts %}